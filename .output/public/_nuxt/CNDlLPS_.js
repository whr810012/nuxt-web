import{d as R,u as W,N as Z,r,j as J,v as i,y as e,A as U,B as T,z as n,I as P,M as a,J as x,R as w,S as _,U as A,C as y,P as N,V as F,W as H,Q as M,g as G,x as u}from"./DCjIt9qW.js";import{_ as K}from"./ConYotEh.js";import{_ as O}from"./7x8O6jVQ.js";import{u as Q}from"./h4UTid-P.js";import{s as X}from"./x_rD_Ya3.js";const Y={class:"grow"},ee={class:"relative"},te={class:"relative max-w-6xl mx-auto px-4 sm:px-6"},se={class:"pt-32 pb-12 md:pt-40 md:pb-20"},oe={class:"max-w-3xl mx-auto text-center pb-12"},ae={class:"mb-5"},le={class:"h2 bg-clip-text text-transparent bg-linear-to-r from-slate-200/60 via-slate-200 to-slate-200/60"},re={class:"max-w-sm mx-auto"},ne={class:"flex mb-6 bg-slate-800 rounded-lg p-1"},ie={key:0,class:"space-y-4"},ue={class:"block text-sm text-slate-300 font-medium mb-1",for:"email"},de={class:"flex justify-between"},ce={class:"block text-sm text-slate-300 font-medium mb-1",for:"password"},pe={class:"block text-sm text-slate-300 font-medium mb-1",for:"captcha"},me={class:"flex items-center space-x-2"},ve=["src"],fe={key:1,class:"space-y-4"},be={key:0,class:"text-rose-500 text-xs mt-1"},he={class:"flex space-x-2"},ge=["disabled"],xe={key:0},we={key:1},_e={key:2},ye={class:"mt-6"},ke=["disabled"],Ce={key:0},Ie={key:1},$e={class:"text-center mt-4"},Ve={class:"text-sm text-slate-400"},Se={class:"flex items-center my-6"},Ue={class:"text-sm text-slate-500 italic"},Te={class:"flex space-x-3"},Ne={class:"btn text-slate-300 hover:text-white transition duration-150 ease-in-out w-full group [background:linear-gradient(var(--color-slate-900),var(--color-slate-900))_padding-box,conic-gradient(var(--color-slate-400),var(--color-slate-700)_25%,var(--color-slate-700)_75%,var(--color-slate-400)_100%)_border-box] relative before:absolute before:inset-0 before:bg-slate-800/30 before:rounded-full before:pointer-events-none h-9"},Le={class:"relative"},qe={class:"sr-only"},Be={class:"btn text-slate-300 hover:text-white transition duration-150 ease-in-out w-full group [background:linear-gradient(var(--color-slate-900),var(--color-slate-900))_padding-box,conic-gradient(var(--color-slate-400),var(--color-slate-700)_25%,var(--color-slate-700)_75%,var(--color-slate-400)_100%)_border-box] relative before:absolute before:inset-0 before:bg-slate-800/30 before:rounded-full before:pointer-events-none h-9"},De={class:"relative"},Pe={class:"sr-only"},We=R({__name:"SignIn",setup(He){const j=W(),I=Z(),{showToast:c}=Q(),m=r("ersan"),v=r("123456"),f=r(),L=r(),q=r(),k=r(!1),p=r("password"),d=r(""),b=r(""),h=r(""),C=r(!1),g=r(0),$=r(null),B=J(()=>/^1[3-9]\d{9}$/.test(d.value)),D=s=>{p.value=s,h.value="",s==="sms"?(m.value="",v.value="",f.value=""):(d.value="",b.value="")},V=()=>d.value?B.value?(h.value="",!0):(h.value="请输入有效的手机号码",!1):(h.value="请输入手机号码",!1),z=async()=>{if(V())try{C.value=!0,await N("/sms/enroll",{number:d.value}),c("验证码发送成功"),g.value=60,$.value=X(()=>{g.value--,g.value<=0&&(clearInterval($.value),$.value=null)},1e3)}catch(s){console.error("发送短信验证码失败:",s),c(s.message||"发送验证码失败，请稍后重试")}finally{C.value=!1}},E=async s=>{s.preventDefault();try{k.value=!0;let t;if(p.value==="password"){if(!m.value||!v.value||!f.value)return c("请输入完整信息");const o=F(v.value),l=new FormData;l.append("userName",m.value),l.append("password",o),l.append("captcha",f.value),l.append("captchaKey",q.value),t=await H("/login/user",l)}else{if(!V())return;if(!b.value)return c("请输入短信验证码");const o={phone:d.value,smsCode:b.value};t=await H("/login/sms/user",o)}if(console.log("response",t),t!=null&&t.token){c("登录成功"),I.setToken(t.token),I.setUserInfo({userId:t.userId}),localStorage.setItem("token",t.token),localStorage.setItem("userId",JSON.stringify(t.userId));try{const o=await N("/user/query");o.email&&(o.email=M(o.email)),o.phonenumber&&(o.phonenumber=M(o.phonenumber)),I.setUserInfo(o),j.push("/")}catch(o){console.log("获取用户信息失败",o),c(o.message||o.msg||"获取用户信息失败")}}else throw console.log("登录失败",t),new Error("登录失败")}catch(t){console.log("登录失败",t);const o=p.value==="password"?"登录失败，请检查用户名和密码":"登录失败，请检查手机号和验证码";c(t.message||t.msg||o),p.value==="password"&&S()}finally{k.value=!1}},S=async()=>{const s=await N("/login/capacha");L.value="data:image/png;base64,"+s.img,q.value=s.uuid};return S(),(s,t)=>{const o=G("router-link");return u(),i("main",Y,[e("section",ee,[t[15]||(t[15]=e("div",{class:"md:block absolute left-1/2 -translate-x-1/2 -mt-36 blur-2xl opacity-70 pointer-events-none -z-10","aria-hidden":"true"},[e("img",{src:K,class:"max-w-none",width:"1440",height:"450",alt:"Page Illustration"})],-1)),e("div",te,[e("div",se,[e("div",oe,[e("div",ae,[U(o,{class:"inline-flex",to:"/"},{default:T(()=>t[7]||(t[7]=[e("div",{class:"relative flex items-center justify-center w-16 h-16 border border-transparent rounded-2xl shadow-2xl [background:linear-gradient(var(--color-slate-900),var(--color-slate-900))_padding-box,conic-gradient(var(--color-slate-400),var(--color-slate-700)_25%,var(--color-slate-700)_75%,var(--color-slate-400)_100%)_border-box] before:absolute before:inset-0 before:bg-slate-800/30 before:rounded-2xl"},[e("img",{class:"relative",src:O,width:"42",height:"42",alt:"Stellar"})],-1)])),_:1})]),e("h1",le,n(s.$t("auth.signIn")),1)]),e("div",re,[e("div",ne,[e("button",{type:"button",class:P(["flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors",a(p)==="password"?"bg-purple-500 text-white shadow":"text-slate-400"]),onClick:t[0]||(t[0]=l=>D("password"))}," 密码登录 ",2),e("button",{type:"button",class:P(["flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors",a(p)==="sms"?"bg-purple-500 text-white shadow":"text-slate-400"]),onClick:t[1]||(t[1]=l=>D("sms"))}," 短信登录 ",2)]),e("form",{onSubmit:E},[a(p)==="password"?(u(),i("div",ie,[e("div",null,[e("label",ue,n(s.$t("auth.userName")),1),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>_(m)?m.value=l:null),id:"email",class:"form-input w-full",required:""},null,512),[[w,a(m)]])]),e("div",null,[e("div",de,[e("label",ce,n(s.$t("auth.password")),1),U(o,{class:"text-sm font-medium text-purple-500 hover:text-purple-400 transition duration-150 ease-in-out ml-2",to:"/resetpassword"},{default:T(()=>[y(n(s.$t("auth.forgot")),1)]),_:1})]),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>_(v)?v.value=l:null),id:"password",class:"form-input w-full",type:"password",autocomplete:"on",required:""},null,512),[[w,a(v)]])]),e("div",null,[e("label",pe,n(s.$t("auth.verification")),1),e("div",me,[x(e("input",{id:"captcha","onUpdate:modelValue":t[4]||(t[4]=l=>_(f)?f.value=l:null),class:"form-input flex-1",type:"text",required:""},null,512),[[w,a(f)]]),e("img",{src:a(L),onClick:S,class:"h-10 w-24 cursor-pointer rounded border border-slate-800",alt:"Verification Code"},null,8,ve)])])])):(u(),i("div",fe,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"phone"},[y("手机号 "),e("span",{class:"text-rose-500"},"*")],-1)),x(e("input",{id:"phone","onUpdate:modelValue":t[5]||(t[5]=l=>_(d)?d.value=l:null),class:"form-input w-full",type:"tel",placeholder:"请输入手机号",onBlur:V,required:""},null,544),[[w,a(d)]]),a(h)?(u(),i("p",be,n(a(h)),1)):A("",!0)]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"smsCode"},[y("短信验证码 "),e("span",{class:"text-rose-500"},"*")],-1)),e("div",he,[x(e("input",{id:"smsCode","onUpdate:modelValue":t[6]||(t[6]=l=>_(b)?b.value=l:null),class:"form-input flex-1",type:"text",placeholder:"请输入验证码",required:""},null,512),[[w,a(b)]]),e("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-purple-500 hover:bg-purple-600 disabled:bg-gray-400 disabled:cursor-not-allowed rounded transition-colors",disabled:a(C)||a(g)>0||!a(B),onClick:z},[a(C)?(u(),i("span",xe,"发送中...")):a(g)>0?(u(),i("span",we,n(a(g))+"s",1)):(u(),i("span",_e,"获取验证码"))],8,ge)])])])),e("div",ye,[e("button",{type:"submit",class:"btn text-sm text-white bg-purple-500 hover:bg-purple-600 w-full shadow-xs group",disabled:a(k)},[a(k)?(u(),i("span",Ce,n(s.$t("common.loading"))+"...",1)):(u(),i("span",Ie,[y(n(s.$t("auth.signIn"))+" ",1),t[10]||(t[10]=e("span",{class:"tracking-normal text-purple-300 group-hover:translate-x-0.5 transition-transform duration-150 ease-in-out ml-1"},"->",-1))]))],8,ke)])],32),e("div",$e,[e("div",Ve,[U(o,{class:"font-medium text-purple-500 hover:text-purple-400 transition duration-150 ease-in-out",to:"/signup"},{default:T(()=>[y(n(s.$t("auth.signUp")),1)]),_:1})])]),e("div",Se,[t[11]||(t[11]=e("div",{class:"border-t border-slate-800 grow mr-3","aria-hidden":"true"},null,-1)),e("div",Ue,n(s.$t("common.or")),1),t[12]||(t[12]=e("div",{class:"border-t border-slate-800 grow ml-3","aria-hidden":"true"},null,-1))]),e("div",Te,[e("button",Ne,[e("span",Le,[e("span",qe,n(s.$t("auth.continueWith"))+" Twitter",1),t[13]||(t[13]=e("svg",{class:"fill-current",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"12"},[e("path",{d:"m4.34 0 2.995 3.836L10.801 0h2.103L8.311 5.084 13.714 12H9.482L6.169 7.806 2.375 12H.271l4.915-5.436L0 0h4.34Zm-.635 1.155H2.457l7.607 9.627h1.165L3.705 1.155Z"})],-1))])]),e("button",Be,[e("span",De,[e("span",Pe,n(s.$t("auth.continueWith"))+" GitHub",1),t[14]||(t[14]=e("svg",{class:"fill-current",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"15"},[e("path",{d:"M7.488 0C3.37 0 0 3.37 0 7.488c0 3.276 2.153 6.084 5.148 7.113.374.094.468-.187.468-.374v-1.31c-2.06.467-2.527-.936-2.527-.936-.375-.843-.843-1.124-.843-1.124-.655-.468.094-.468.094-.468.749.094 1.123.75 1.123.75.655 1.216 1.778.842 2.153.654.093-.468.28-.842.468-1.03-1.685-.186-3.37-.842-3.37-3.743 0-.843.281-1.498.75-1.966-.094-.187-.375-.936.093-1.965 0 0 .655-.187 2.059.749a6.035 6.035 0 0 1 1.872-.281c.655 0 1.31.093 1.872.28 1.404-.935 2.059-.748 2.059-.748.374 1.03.187 1.778.094 1.965.468.562.748 1.217.748 1.966 0 2.901-1.778 3.463-3.463 3.65.281.375.562.843.562 1.498v2.059c0 .187.093.468.561.374 2.996-1.03 5.148-3.837 5.148-7.113C14.976 3.37 11.606 0 7.488 0Z"})],-1))])])])])])])])])}}});export{We as default};
