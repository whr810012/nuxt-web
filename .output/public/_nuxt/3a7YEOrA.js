import{N as z,r as g,j as A,X as h,o as C,O as D,v as i,y as s,U as f,I as T,M as o,z as N,H as V,J as m,R as p,Y as $,P as B,Q as _,x as u,W as F,$ as H}from"./DCjIt9qW.js";import{_ as L}from"./ConYotEh.js";import{u as O}from"./h4UTid-P.js";const R={class:"relative"},E={class:"relative max-w-6xl mx-auto px-4 sm:px-6"},J={class:"pt-32 pb-12 md:pt-40 md:pb-20"},Q={class:"max-w-xl mx-auto mb-6 flex space-x-4"},W={class:"max-w-xl mx-auto bg-slate-800/50 rounded-xl border border-slate-700/50 backdrop-blur-sm p-6 shadow-lg"},X={key:0,class:"flex flex-col items-center mb-6"},Y={class:"relative group"},Z={class:"w-24 h-24 rounded-full bg-purple-500/30 flex items-center justify-center text-purple-200 text-2xl font-bold overflow-hidden mb-4 transition-all duration-300 group-hover:opacity-80"},G=["src"],K={key:1},ee={class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"},se={class:"space-y-4"},te={key:0,class:"text-rose-500 text-xs mt-1"},oe={key:0,class:"text-rose-500 text-xs mt-1"},le={class:"mt-6"},ae=["disabled"],ne={key:0},re={key:1},ie={key:2},ue={class:"space-y-4"},de={class:"mt-6"},me=["disabled"],pe={key:0},ce={key:1},ve={__name:"Profile",setup(fe){const x=z(),{showToast:b}=O(),w=g(!1),v=g(!1),c=g("profile"),d=A(()=>x.getUserInfo),y=g(null),t=h({nickName:"",userName:"",email:"",phonenumber:"",sex:""}),n=h({currentPassword:"",newPassword:"",confirmPassword:""}),r=h({nickName:"",userName:"",email:"",phonenumber:"",password:"",sex:""}),P=async()=>{const l=localStorage.getItem("token");if(l){console.log("token11",l),x.setToken(l);try{console.log("开始请求用户信息");let e=await B("/user/query");e.email&&(e.email=_(e.email)),e.phonenumber&&(e.phonenumber=_(e.phonenumber)),console.log("userInfo 响应数据:",e),x.setUserInfo(e),e.value&&(t.nickName=e.value.nickName||"",t.userName=e.value.userName||"",t.email=e.value.email||"",t.phonenumber=e.value.phonenumber||"",t.sex=e.value.sex)}catch(e){console.log("获取用户信息失败",e),e.response?(console.log("错误状态:",e.response.status),console.log("错误数据:",e.response.data)):e.request?console.log("没有收到响应:",e.request):console.log("请求错误:",e.message)}}};C(async()=>{await D(),await P(),d.value&&(t.nickName=d.value.nickName||"",t.userName=d.value.userName||"",t.email=d.value.email||"",t.phonenumber=d.value.phonenumber||"",t.sex=d.value.sex)});const I=l=>{const e=l.target.files[0];if(y.value=e,e){const k=URL.createObjectURL(e);t.authorities=k}},S=()=>{let l=!0;return Object.keys(r).forEach(e=>{r[e]=""}),console.log("验证开始"),t.nickName.length<2&&(r.nickName="昵称至少需要2个字符",console.log("昵称错误:",r.nickName),l=!1),/^[a-zA-Z0-9]{5,}$/.test(t.userName)||(r.userName="用户名只能包含英文和数字，且至少5个字符",l=!1),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(r.email="请输入有效的邮箱地址",l=!1),/^1[3-9]\d{9}$/.test(t.phonenumber)||(r.phonenumber="请输入有效的手机号",l=!1),t.sex||(r.sex="请选择性别",l=!1),l},j=async()=>{if(S())try{w.value=!0;let l=new FormData;t.nickName!==d.value.nickName&&l.append("nickName",t.nickName),t.email!==d.value.email&&l.append("email",t.email),t.sex!==d.value.sex&&l.append("sex",t.sex),y.value&&l.append("file",y.value),console.log(d.value,x.getUserInfo),l.append("id",x.getUserInfo.id);const e=await F("/user/amend",l);P(),b("个人资料更新成功")}catch(l){console.error("更新个人资料失败:",l),b("个人资料更新失败")}finally{w.value=!1}},q=async()=>{if(n.newPassword!==n.confirmPassword){b("两次密码输入不一致");return}try{v.value=!0,(await H("/user/updatePwd",{oldPassword:n.currentPassword,newPassword:n.newPassword})).code===200&&(b("密码更新成功"),n.currentPassword="",n.newPassword="",n.confirmPassword="")}catch(l){console.error("更新密码失败:",l),b("密码更新失败")}finally{v.value=!1}},M=l=>{c.value=l};return(l,e)=>{var k,U;return u(),i("main",null,[s("section",R,[e[24]||(e[24]=s("div",{class:"md:block absolute left-1/2 -translate-x-1/2 -mt-36 blur-2xl opacity-70 pointer-events-none -z-10","aria-hidden":"true"},[s("img",{src:L,class:"max-w-none",width:"1440",height:"450",alt:"Page Illustration"})],-1)),s("div",E,[s("div",J,[e[23]||(e[23]=s("div",{class:"max-w-3xl mx-auto text-center pb-12"},[s("h1",{class:"h2 bg-clip-text text-transparent bg-linear-to-r from-slate-200/60 via-slate-200 to-slate-200/60"}," 个人资料")],-1)),s("div",Q,[s("button",{onClick:e[0]||(e[0]=a=>M("profile")),class:T(["flex-1 py-2 px-4 rounded-lg transition-all duration-300 font-medium text-center",{"bg-purple-500 text-white":o(c)==="profile","bg-slate-700/50 text-slate-300 hover:bg-slate-700":o(c)!=="profile"}])}," 个人信息 ",2),f("",!0)]),s("div",W,[o(c)==="profile"?(u(),i("div",X,[s("div",Y,[s("div",Z,[o(t).authorities?(u(),i("img",{key:0,src:o(t).authorities,alt:"Avatar",class:"w-full h-full object-cover"},null,8,G)):(u(),i("span",K,N((U=(k=o(d))==null?void 0:k.nickName)==null?void 0:U.charAt(0).toUpperCase()),1))]),s("div",ee,[e[10]||(e[10]=s("label",{for:"authorities-upload",class:"cursor-pointer"},[s("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)),s("input",{id:"authorities-upload",type:"file",accept:"image/*",onChange:I,class:"hidden"},null,32)])]),e[11]||(e[11]=s("span",{class:"text-sm text-slate-400"},"点击头像更换",-1))])):f("",!0),o(c)==="profile"?(u(),i("form",{key:1,onSubmit:V(j,["prevent"])},[s("div",se,[s("div",null,[e[12]||(e[12]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"nick-name"},"昵称",-1)),m(s("input",{id:"nick-name","onUpdate:modelValue":e[2]||(e[2]=a=>o(t).nickName=a),class:"form-input w-full",type:"text",required:""},null,512),[[p,o(t).nickName]]),o(r).nickName?(u(),i("p",te,N(o(r).nickName),1)):f("",!0)]),s("div",null,[e[13]||(e[13]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"user-name"},"用户名",-1)),m(s("input",{id:"user-name","onUpdate:modelValue":e[3]||(e[3]=a=>o(t).userName=a),class:"form-input w-full",type:"text",disabled:""},null,512),[[p,o(t).userName]]),e[14]||(e[14]=s("p",{class:"text-xs text-slate-500 mt-1"},"用户名不可修改",-1))]),s("div",null,[e[15]||(e[15]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"email"},"邮箱",-1)),m(s("input",{id:"email","onUpdate:modelValue":e[4]||(e[4]=a=>o(t).email=a),class:"form-input w-full",type:"email"},null,512),[[p,o(t).email]]),o(r).email?(u(),i("p",oe,N(o(r).email),1)):f("",!0)]),s("div",null,[e[16]||(e[16]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"phonenumber"},"手机号",-1)),m(s("input",{id:"phonenumber","onUpdate:modelValue":e[5]||(e[5]=a=>o(t).phonenumber=a),class:"form-input w-full",type:"tel",disabled:""},null,512),[[p,o(t).phonenumber]]),e[17]||(e[17]=s("p",{class:"text-xs text-slate-500 mt-1"},"手机号不可修改",-1))]),s("div",null,[e[19]||(e[19]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"gender"},"性别",-1)),m(s("select",{id:"gender","onUpdate:modelValue":e[6]||(e[6]=a=>o(t).sex=a),class:"form-select text-sm py-2 w-full"},e[18]||(e[18]=[s("option",{value:"男"},"男",-1),s("option",{value:"女"},"女",-1)]),512),[[$,o(t).sex]])])]),s("div",le,[s("button",{type:"submit",class:"btn text-sm text-white bg-purple-500 hover:bg-purple-600 w-full shadow-xs",disabled:o(w)},[o(w)?(u(),i("span",ne,"保存中...")):(u(),i("span",re,"保存修改"))],8,ae)])],32)):f("",!0),o(c)==="password"?(u(),i("div",ie,[s("form",{onSubmit:V(q,["prevent"])},[s("div",ue,[s("div",null,[e[20]||(e[20]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"current-password"},"当前密码",-1)),m(s("input",{id:"current-password","onUpdate:modelValue":e[7]||(e[7]=a=>o(n).currentPassword=a),class:"form-input w-full",type:"password",required:""},null,512),[[p,o(n).currentPassword]])]),s("div",null,[e[21]||(e[21]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"new-password"},"新密码",-1)),m(s("input",{id:"new-password","onUpdate:modelValue":e[8]||(e[8]=a=>o(n).newPassword=a),class:"form-input w-full",type:"password",required:""},null,512),[[p,o(n).newPassword]])]),s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm text-slate-300 font-medium mb-1",for:"confirm-password"},"确认新密码",-1)),m(s("input",{id:"confirm-password","onUpdate:modelValue":e[9]||(e[9]=a=>o(n).confirmPassword=a),class:"form-input w-full",type:"password",required:""},null,512),[[p,o(n).confirmPassword]])])]),s("div",de,[s("button",{type:"submit",class:"btn text-sm text-white bg-purple-500 hover:bg-purple-600 w-full shadow-xs",disabled:o(v)},[o(v)?(u(),i("span",pe,"更新中...")):(u(),i("span",ce,"更新密码"))],8,me)])],32)])):f("",!0)])])])])])}}};export{ve as default};
